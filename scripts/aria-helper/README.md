# AriaEh - Aria2下载助手（修改版）

Aria2下载管理脚本，与EhSearchEnhancer深度适配，提供便捷的下载和种子管理功能，修复了归档发送到Arai2、有时原文件名丢失的问题。

## ✨ 功能特性

### 📥 Aria2下载管理
- ✅ **Aria2集成**
  - 直接发送磁链到Aria2
  - 支持自定义Aria2 RPC地址和端口
  - 实时下载状态显示
  - 支持批量发送

- ✅ **链接支持**
  - 磁力链接（magnet://）
  - 种子文件
  - 直接HTTP/HTTPS链接

### 🔍 种子信息
- 🌱 **种子显示**
  - 在画廊上显示种子可用性
  - 种子状态一目了然

- 📋 **快速菜单**
  - 种子右键菜单快速操作
  - 一键复制链接
  - 一键下载种子

### 📊 功能增强
- 💾 **下载历史**
  - 记录最近下载的画廊
  - 快速重新下载

- 🔧 **个性化配置**
  - 自定义Aria2端口
  - 记忆用户偏好

## 🔧 安装

### 前置要求
1. **Tampermonkey/Greasemonkey** - 脚本管理器
2. **Aria2** - 下载管理工具（推荐）
   - 下载地址：https://github.com/aria2/aria2/releases
   - 或使用 Aria2 Web UI：https://github.com/ziahamza/webui-aria2

### 安装步骤

1. **安装脚本**
   - 打开 Tampermonkey/Greasemonkey
   - 点击"创建新脚本"
   - 复制 `AriaEh.user.js` 的全部内容
   - 粘贴到编辑器并保存

2. **配置Aria2**
   ```
   • 启动 Aria2 服务
   • 记下RPC监听地址和端口（默认 http://127.0.0.1:6800）
   • 在脚本设置中配置该地址
   ```


## 📖 使用指南

### 基础使用

#### 1. 配置下载工具
```
• 点击页面上的设置按钮
• 找到 Aria2 的配置项
• 输入正确的服务地址和端口
• 保存设置
```

#### 2. 发送下载
```
方式一：通过EhSearchEnhancer
• 选择画廊后右键菜单 → "发送下载"
• 选择下载通道和链接类型
• 确认发送

方式二：直接发送
• 在画廊页面点击下载按钮
• 选择目标工具（Aria2）
• 下载开始
```

#### 3. 查看下载状态
```
• Aria2Web UI - 访问 http://localhost:6800/webui
```

### 高级功能

#### 批量下载
- 结合 EhSearchEnhancer 的多选功能
- 一次性发送多个画廊到Aria2
- 支持自动队列管理

#### 种子管理
- 查看种子可用性
- 一键下载种子文件

#### 下载历史
- 查看最近下载的画廊
- 快速重新发送
- 导出下载列表

## ⚙️ 配置说明

### Aria2 配置

#### RPC地址
- **默认值**：http://127.0.0.1:6800
- **说明**：Aria2 RPC 服务的访问地址
- **修改方法**：在设置中更改端口

#### 协议支持
- 磁力链接（magnet://）
- 种子文件
- 直接HTTP/HTTPS链接

#### 推荐配置
```
Aria2启动参数：
aria2c --enable-rpc --rpc-listen-port=6800
```

### 脚本设置

#### 自动保存偏好
- 记住上次使用的下载工具
- 记住上次选择的链接类型

#### 下载历史
- 最多保存100条记录
- 可导出为文件
- 可导入历史记录

## 🔗 与EhSearchEnhancer的集成

### 无缝协作
```
EhSearchEnhancer                AriaEh
    ↓                             ↓
  选择画廊 ← 右键菜单 → 发送下载
    ↓                             ↓
   多选    →  统一对话框  →    Aria2
```

### 共享设置
- 共享Aria2端口配置
- 同步下载历史记录

## 🐛 故障排查

### Aria2连接失败
```
症状：提示"无法连接到Aria2"

解决方案：
1. 确保Aria2已启动
   $ aria2c --enable-rpc

2. 检查端口是否正确
   默认端口：6800
   
3. 检查防火墙设置
   确保未被防火墙拦截
   
4. 尝试直接访问
   在浏览器打开：http://localhost:6800
   应该返回403 Forbidden或其他响应（不是连接拒绝）
```

### AB DM连接失败
```
症状：提示"无法连接到AB DM"

解决方案：
1. 确保AB DM已启动
2. 检查端口配置（通常是6800）
3. 在AB DM设置中查看监听地址
4. 如是局域网，确保网络连接正常
```

### 下载无反应
```
症状：点击下载但没有反应

解决方案：
1. 查看浏览器控制台是否有错误
2. 检查所选链接类型是否可用
   - 某些画廊可能没有磁链
   - 某些画廊可能没有种链
3. 尝试使用另一个下载工具
4. 刷新页面后重试
```

### 页面崩溃或卡顿
```
症状：页面响应变慢或无响应

解决方案：
1. 禁用自动刷新功能
2. 减少批量操作数量
3. 清空浏览器缓存
4. 更新脚本到最新版本
```

## 🔄 更新日志

### v2.0 (修改版)
- ✨ 深度适配EhSearchEnhancer
- 🔧 修复了某些情况下获取不到压缩包名称的问题
- 🎨 优化菜单界面
- 📊 增强下载历史功能
- ⚙️ 完善配置系统

### 原始版本
- 基础的Aria2集成功能
- 种子管理功能

## 🙏 致谢

- 原作者：[SchneeHertz](https://github.com/SchneeHertz)
- 原项目：[EH-UserScripts](https://github.com/SchneeHertz/EH-UserScripts)

## 📝 相关链接

- [Aria2官网](https://github.com/aria2/aria2)
- [Aria2 WebUI](https://github.com/ziahamza/webui-aria2)
- [EhSearchEnhancer](../search-enhancer/README.md)

## 📄 许可证

MIT License - 详见项目根目录的 LICENSE 文件

## 📮 反馈与支持

遇到问题或有建议？
- 提交 GitHub Issue
- 在脚本站点留言

---

**最后更新**：2026-01-12
